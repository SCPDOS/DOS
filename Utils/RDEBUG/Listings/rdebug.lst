     1                                  ;ROM Debugger activator.
     2                                  ;Tests if address of Int 38h is not equal to Int 39h
     3                                  ;If it is not, it scans the 64Kb block after the ROMBIOS for the string SCPBIOS
     4                                  ;If it finds it, it triggers Int 38h to enter the debugger
     5                                  [map all ./Utils/RDEBUG/Listings/rdebug.map]
     6                                  [DEFAULT REL]
     7                                  BITS 64
     8 00000000 B838350000                  mov eax, 3538h  ;Get the ptr for interrupt 38h in rbx
     9 00000005 CD41                        int 41h
    10 00000007 4889DF                      mov rdi, rbx
    11 0000000A B839350000                  mov eax, 3539h
    12 0000000F CD41                        int 41h
    13 00000011 4839DF                      cmp rdi, rbx
    14 00000014 740B                        je .badExit
    15                                      ;Now we scan 64Kb from rdi
    16 00000016 B053                        mov al, "S"
    17 00000018 B900000100                  mov ecx, 10000h
    18                                  .keepSearching:
    19 0000001D F2AE                        repne scasb
    20 0000001F 7415                        je .potential
    21                                  .badExit:
    22 00000021 488D1526000000              lea rdx, badMsg
    23 00000028 B800090000                  mov eax, 0900h
    24 0000002D CD41                        int 41h
    25 0000002F B8FF4C0000                  mov eax, 4CFFh
    26 00000034 CD41                        int 41h
    27                                  .potential:
    28 00000036 50                          push rax
    29 00000037 57                          push rdi
    30 00000038 48FFCF                      dec rdi
    31 0000003B 48B853595344454255-         mov rax, "SYSDEBUG"
    31 00000044 47                 
    32 00000045 483907                      cmp qword [rdi], rax
    33 00000048 5F                          pop rdi
    34 00000049 58                          pop rax
    35 0000004A 75D1                        jne .keepSearching
    36 0000004C CD38                        int 38h ;Exits via DOS
    37                                  
    38 0000004E 5343502F42494F5320-     badMsg:  db "SCP/BIOS Debugger Not Detected",0Dh,0Ah,"$"
    38 00000057 446562756767657220-
    38 00000060 4E6F74204465746563-
    38 00000069 7465640D0A24       
    38          ------------------       info: assembly required 1+2+2 passes

